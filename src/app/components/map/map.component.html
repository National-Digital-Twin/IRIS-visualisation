@let hasSpatialFilter = spatialFilterEnabled();
@let theme = theme$ | async;

@if (theme) {
    <div class="map-controls top">
        <div class="control-group">
            <button mat-mini-fab class="control" (click)="resetMapView.emit(null)" matTooltip="Reset view">
                <img [src]="theme === 'light' ? 'assets/icons/House.svg' : 'assets/icons/House_white.svg'" alt="reset map view" />
            </button>
        </div>
        <div class="control-group">
            <button mat-mini-fab class="control" (click)="resetNorth.emit(null)" matTooltip="Reset to north">
                <img
                    [src]="theme === 'light' ? 'assets/icons/Compass.svg' : 'assets/icons/Compass_white.svg'"
                    [style]="'transform: rotate(' + bearing + 'deg)'"
                    alt="reset to north"
                />
            </button>
            <button mat-mini-fab class="control text" (click)="changeDimensions()" [matTooltip]="twoDimensions ? 'Tilt the view to 3D' : 'Tilt the view to 2D'">
                @if (!twoDimensions) {
                    2D
                } @else {
                    3D
                }
            </button>
        </div>
        <div class="control-group">
            <button class="control" mat-mini-fab (click)="zoomIn.emit(null)" matTooltip="Zoom in">
                <img [src]="theme === 'light' ? 'assets/icons/Plus.svg' : 'assets/icons/Plus_white.svg'" alt="zoom in" />
            </button>
            <button class="control" mat-mini-fab (click)="zoomOut.emit(null)" matTooltip="Zoom out">
                <img [src]="theme === 'light' ? 'assets/icons/Minus.svg' : 'assets/icons/Minus_white.svg'" alt="zoom out" />
            </button>
        </div>
        <div class="control-group">
            <button class="control" mat-mini-fab matTooltip="Draw filter area" [ngClass]="{ active: this.drawActive }" (click)="setDrawMode('polygon')">
                @if (theme === 'light') {
                    <img [src]="!this.drawActive ? 'assets/icons/SpatialSearch.svg' : 'assets/icons/SpatialSearch_white.svg'" alt="draw polygon" />
                } @else {
                    <img [src]="'assets/icons/SpatialSearch_white.svg'" alt="draw polygon" />
                }
            </button>
            @if (hasSpatialFilter && mapInstance.getZoom() < 15) {
                <button class="control" mat-mini-fab matTooltip="Download addresses" (click)="downloadAddresses.emit(null)">
                    <img [src]="theme === 'light' ? 'assets/icons/Download.svg' : 'assets/icons/Download_white.svg'" alt="download addresses" />
                </button>
            }
            <button class="control" mat-mini-fab matTooltip="Delete filter area" (click)="setDrawMode('delete')" [disabled]="!hasSpatialFilter">
                <img [src]="theme === 'light' ? 'assets/icons/Trash.svg' : 'assets/icons/Trash_white.svg'" alt="delete polygon" />
            </button>
        </div>
        <div class="control-group">
            <button mat-mini-fab class="control" (click)="showLegend = !showLegend" matTooltip="Legend">
                <img [src]="theme === 'light' ? 'assets/icons/MapControls.svg' : 'assets/icons/MapControls_white.svg'" alt="open legend" />
            </button>
            @if (showLegend) {
                <c477-legend />
            }
        </div>
    </div>
    <div class="map-controls bottom">
        <div class="control-group">
            <button mat-mini-fab class="control" (click)="toggleMinimap.emit(null)" matTooltip="Minimap">
                <img [src]="theme === 'light' ? 'assets/icons/MapTrifold.svg' : 'assets/icons/MapTrifold_white.svg'" alt="open minimap" />
            </button>
        </div>
    </div>
}
<div id="map" class="map"></div>
