@if (buildingDetails()) {
  <div class="panel details-panel">
    <div class="details-panel__header">
      <h1>
        {{ getAddressSegment(0) }}
        {{ getAddressSegment(1) }}
      </h1>
      <button mat-icon-button (click)="closePanel.emit()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    <div class="details-panel__overview">
      <p class="address">{{ buildingDetails()?.FullAddress }}</p>
      @if (buildingDetails()?.EPC) {
        <div class="labels">
          <c477-label
            [epcRating]="buildingDetails()?.EPC"
            [sapPoints]="buildingDetails()?.SAPPoints"></c477-label>
          <c477-label>{{ buildingDetails()?.PropertyType }}</c477-label>
        </div>
      } @else {
        <div class="labels">
          <c477-label [epcRating]="'none'"></c477-label>
        </div>
      }
    </div>
    <mat-tab-group
      mat-stretch-tabs="false"
      mat-align-tabs="start"
      (selectedTabChange)="tabChanged($event)">
      <mat-tab label="Overview" aria-label="Property overview">
        <div class="details-panel__tab details-panel__tab--overview">
          <div class="column-data about">
            <h2>About</h2>
            <p>
              <span class="field">Built form:</span>
              @if (buildingDetails()?.BuildForm) {
                <span>{{ buildForm[buildingDetails()!.BuildForm!] }}</span>
              } @else {
                <span>No data</span>
              }
            </p>
            <p>
              <span class="field">Inspection date:</span>
              @if (buildingDetails()?.InspectionDate) {
                <span>{{ buildingDetails()?.InspectionDate | date }}</span>
              } @else {
                <span>No data</span>
              }
            </p>

            <p>
              <span class="field">UPRN:</span>
              <span>{{ buildingDetails()?.UPRN }}</span>
            </p>
          </div>
          <div class="specification">
            <h2>Specification</h2>
            <p>
              <span class="field">Floor construction:</span>
              @if (
                buildingDetails()?.FloorConstruction &&
                floor[buildingDetails()!.FloorConstruction!]
              ) {
                <span>{{ floor[buildingDetails()!.FloorConstruction!] }}</span>
              } @else {
                <span>No data</span>
              }
            </p>
            <p>
              <span class="field">Floor insulation:</span>
              @if (
                buildingDetails()?.FloorInsulation &&
                floorInsulation[buildingDetails()!.FloorInsulation!]
              ) {
                <span>{{
                  floorInsulation[buildingDetails()!.FloorInsulation!]
                }}</span>
              } @else {
                <span>No data</span>
              }
            </p>
            <p>
              <span class="field">Roof construction:</span>
              @if (
                buildingDetails()?.RoofConstruction &&
                roof[buildingDetails()!.RoofConstruction!]
              ) {
                <span>{{ roof[buildingDetails()!.RoofConstruction!] }}</span>
              } @else {
                <span>No data</span>
              }
            </p>
            <p>
              <span class="field">Roof insulation location:</span>
              @if (
                buildingDetails()?.RoofInsulationLocation &&
                roofInsulation[buildingDetails()!.RoofInsulationLocation!]
              ) {
                <span>{{
                  roofInsulation[buildingDetails()!.RoofInsulationLocation!]
                }}</span>
              } @else {
                <span>No data</span>
              }
            </p>
            <p>
              <span class="field">Roof insulation thickness:</span>
              @if (
                buildingDetails()?.RoofInsulationThickness &&
                buildingDetails()!.RoofInsulationThickness!
              ) {
                <span>{{ buildingDetails()!.RoofInsulationThickness }}</span>
              } @else {
                <span>No data</span>
              }
            </p>
            <p>
              <span class="field">Wall construction:</span>
              @if (
                buildingDetails()?.WallConstruction &&
                wall[buildingDetails()!.WallConstruction!]
              ) {
                <span>{{ wall[buildingDetails()!.WallConstruction!] }}</span>
              } @else {
                <span>No data</span>
              }
            </p>
            <p>
              <span class="field">Window glazing:</span>
              @if (
                buildingDetails()?.WindowGlazing &&
                windowGlazing[buildingDetails()!.WindowGlazing!]
              ) {
                <span>{{
                  windowGlazing[buildingDetails()!.WindowGlazing!]
                }}</span>
              } @else {
                <span>No data</span>
              }
            </p>
          </div>
        </div>
      </mat-tab>
      <mat-tab label="Flag">
        <div class="details-panel__tab">
          @if (activeFlag() || flagHistory().length !== 0) {
            <div class="about">
              <h2>Active Flag</h2>
              @if (activeFlag()) {
                <div class="column-data">
                  <p>
                    <span class="field">Flagged by:</span
                    ><span
                      >{{ activeFlag()!.FlaggedByGivenName }}
                      {{ activeFlag()!.FlaggedBySurname }}</span
                    >
                  </p>
                  <p>
                    <span class="field">Flag date:</span
                    ><span>{{
                      activeFlag()!.FlagDate | date: 'dd-MMM-YYYY'
                    }}</span>
                  </p>
                </div>
              } @else {
                <p class="no-flag">This dwelling is not currently flagged</p>
              }
            </div>
            <div class="details-panel__history">
              <h2>Previous Flags</h2>
              @if (flagHistory().length) {
                @for (flag of flagHistory(); track flag.Flagged) {
                  <div class="historical-flag">
                    <img src="assets/icons/FlagPennant.svg" alt="" />
                    <div>
                      <p>
                        <strong
                          >Flagged on
                          {{ flag.FlagDate | date: 'dd-MMM-YYYY' }}</strong
                        >
                      </p>
                      <p>
                        <span class="field">Flagged by: </span
                        ><span
                          >{{ flag.FlaggedByGivenName }}
                          {{ flag.FlaggedBySurname }}</span
                        >
                      </p>
                      <p>
                        <span class="field">Remove date: </span
                        ><span>{{ flag.FlagDate | date: 'dd-MMM-YYYY' }}</span>
                      </p>
                      <p>
                        <span class="field">Removed by: </span
                        ><span
                          >{{ flag.AssessorGivenName }}
                          {{ flag.AssessorSurname }}</span
                        >
                      </p>
                      <p>
                        <span class="field">Reason: </span
                        ><span>{{
                          invalidateReason[flag.AssessmentReason]
                        }}</span>
                      </p>
                    </div>
                  </div>
                }
              } @else {
                <p class="no-flag">
                  There are no previous flags for this dwelling
                </p>
              }
            </div>
          } @else {
            <p class="no-flag">There are no flags for this dwelling</p>
          }
        </div>
      </mat-tab>
    </mat-tab-group>
    <div class="details-panel__buttons">
      @if (buildingDetails()?.Flagged === undefined) {
        <button
          mat-flat-button
          color="primary"
          aria-label="Flag property"
          (click)="flag.emit([buildingDetails()!])">
          <img alt="" src="assets/icons/FlagPennant_white.svg" />Add a flag
        </button>
      } @else {
        <button
          mat-flat-button
          color="warn"
          aria-label="Add flag to property"
          (click)="removeFlag.emit(buildingDetails()!)">
          <img alt="" src="assets/icons/TrashFlag_white.svg" />Remove flag
        </button>
      }
      <button
        mat-flat-button
        [color]="'primary'"
        (click)="openDownloadWarning()">
        <img src="assets/icons/FileArrowDown_white.svg" alt="" />Download
      </button>
    </div>
  </div>
}
