@if (buildingSelection()) {
  <div class="panel results-panel">
    <section>
      <div class="results-panel__header">
        <p class="results-panel__number">
          {{ buildingSelection()?.flat()?.length }} results in view
        </p>
        <mat-slide-toggle [color]="'primary'" [(ngModel)]="selectMultiple"
          >Select multiple</mat-slide-toggle
        >
      </div>
      <div class="results-panel__header">
        <button
          mat-flat-button
          class="results-panel__button"
          aria-label="Flag selected properties"
          [disabled]="!selectMultiple && checkedCards.length === 0"
          (click)="onFlagSelected()">
          <img
            alt=""
            [src]="
              theme() === 'light'
                ? 'assets/icons/FlagPennant.svg'
                : 'assets/icons/FlagPennant_white.svg'
            " />
          Flag selected
        </button>
        <button
          mat-flat-button
          [color]="'primary'"
          class="results-panel__button">
          <img src="assets/icons/FileArrowDown_white.svg" alt="" />Download all
        </button>
      </div>
    </section>
    <section class="results-panel__cards-container">
      <cdk-virtual-scroll-viewport
        minBufferPx="500"
        maxBufferPx="1000"
        class="viewport"
        itemSize="143">
        <div
          *cdkVirtualFor="
            let dwellingSet of buildingSelection();
            templateCacheSize: 0;
            trackBy: trackByUPRN
          ">
          @if (dwellingSet.length === 1) {
            <c477-results-card
              [buildingUPRN]="selectedCardUPRN()"
              (cardSelected)="cardSelected($event)"
              (emitViewDetails)="viewDetails($event)"
              [checked]="cardIsChecked(dwellingSet[0].UPRN)"
              (toggleChecked)="onToggleChecked(dwellingSet[0].UPRN)"
              (flag)="onFlag(dwellingSet[0].UPRN)"
              (removeFlag)="onRemoveFlag(dwellingSet[0].UPRN)"
              [card]="dwellingSet[0]"
              [select]="selectMultiple"></c477-results-card>
          } @else {
            <c477-results-card-expandable
              [dwellings]="dwellingSet"
              [select]="selectMultiple"
              (emitViewDetails)="viewDetails($event)"
              (cardSelected)="
                cardSelected($event)
              "></c477-results-card-expandable>
          }
        </div>
      </cdk-virtual-scroll-viewport>
    </section>
  </div>
}
